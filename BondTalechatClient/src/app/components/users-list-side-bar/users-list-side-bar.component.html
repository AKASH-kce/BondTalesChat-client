<div class="main-container">
  <div class="sidebar-header">
    <h2>Chats</h2>
    <button class="new-chat-btn" (click)="openAddUserDialog()">
      <i class="fa-solid fa-user-plus"></i>
    </button>
  </div>

  <div class="conversations-list">
    <div *ngFor="let conv of conversations" class="conversation-item" (click)="conversationClicked(conv, $event)"
      [class.active]="currentUserDetialService.getCurrentConversationId() === conv.conversationId">

      <div class="avatar">
        <img [src]="conv.otherUserProfilePicture || defaultProfileImage" alt="Profile" />
        <span *ngIf="conv.unreadCount > 0" class="unread-badge">{{conv.unreadCount}}</span>
      </div>

      <div class="conversation-content">
        <div class="conversation-header">
          <h3 class="conversation-name">{{conv.isGroup ? conv.title : conv.otherUserName}}</h3>
          <span class="time">{{conv.lastMessageTime}}</span>
        </div>

        <div class="last-message">
          <p *ngIf="conv.lastMessageSenderId && conv.lastMessageSenderId === loginUserId" class="message-prefix">You:
          </p>
          <p class="message-text">{{conv.lastMessage || 'No messages yet'}}</p>
        </div>
      </div>

      <!-- Call Actions -->
      <div class="call-actions" *ngIf="!conv.isGroup">
        <button class="call-btn audio-call-btn" 
                (click)="startAudioCall(conv, $event)"
                title="Start audio call">
          <i class="fa-solid fa-phone"></i>
        </button>
        <button class="call-btn video-call-btn" 
                (click)="startVideoCall(conv, $event)"
                title="Start video call">
          <i class="fa-solid fa-video"></i>
        </button>
      </div>
    </div>

    <div *ngIf="conversations.length === 0" class="empty-state">
      <p>No conversations yet</p>
      <button (click)="openAddUserDialog()">Start a conversation</button>
    </div>
  </div>
</div>